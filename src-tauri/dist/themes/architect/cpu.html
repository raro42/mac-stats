<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="./cpu.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CPU</title>
  </head>
  <body>
    <main class="arch-sheet">
      <header class="arch-header">
        <div class="arch-title">
          <h1>CPU</h1>
          <div class="arch-subtitle" id="chip-info">—</div>
        </div>

        <div class="arch-actions">
          <button id="refresh-btn" class="icon-btn" title="Refresh">↻</button>
          <button id="settings-btn" class="icon-btn" title="Settings">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="3"></circle>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
          </button>
        </div>
      </header>

      <div class="arch-rule" aria-hidden="true"></div>

      <section class="arch-metrics">
        <div class="metric-box">
          <div class="metric-label">Temperature</div>
          <div class="metric-value" id="temperature-value">0°</div>
          <div class="metric-subtext" id="temperature-subtext">—</div>
          <svg class="ring" viewBox="0 0 100 100" aria-hidden="true">
            <path class="ring-track" d="M 15.2 72.4 A 38 38 0 1 1 84.8 72.4" />
            <path class="ring-progress" id="temperature-ring-progress" d="M 15.2 72.4 A 38 38 0 1 1 84.8 72.4" pathLength="264" style="stroke-dashoffset: 264;" />
          </svg>
          <div class="metric-hint" id="temperature-hint" style="display: none;">--</div>
        </div>

        <div class="metric-box" id="cpu-usage-card">
          <div class="metric-label">Usage</div>
          <div class="metric-value" id="cpu-usage-value">0<span class="metric-unit">%</span></div>
          <div class="metric-subtext" id="cpu-usage-subtext">—</div>
          <svg class="ring" viewBox="0 0 100 100" aria-hidden="true">
            <path class="ring-track" d="M 15.2 72.4 A 38 38 0 1 1 84.8 72.4" />
            <path class="ring-progress" id="cpu-usage-ring-progress" d="M 15.2 72.4 A 38 38 0 1 1 84.8 72.4" pathLength="264" style="stroke-dashoffset: 264;" />
          </svg>
        </div>

        <div class="metric-box">
          <div class="metric-label">Frequency</div>
          <div class="metric-value" id="frequency-value">—</div>
          <div class="metric-subtext" id="frequency-subtext">—</div>
          <svg class="ring" viewBox="0 0 100 100" aria-hidden="true">
            <path class="ring-track" d="M 15.2 72.4 A 38 38 0 1 1 84.8 72.4" />
            <path class="ring-progress" id="frequency-ring-progress" d="M 15.2 72.4 A 38 38 0 1 1 84.8 72.4" pathLength="264" style="stroke-dashoffset: 264;" />
          </svg>
          <div class="metric-hint" id="frequency-hint" style="display: none;">--</div>
        </div>
      </section>

      <section class="history-section">
        <div class="history-controls" id="history-controls" style="display: none;">
          <label for="time-range-select">History:</label>
          <select id="time-range-select" class="time-range-dropdown">
            <option value="5m" selected>Last 5 minutes</option>
            <option value="1h">Last 1 hour</option>
            <option value="6h">Last 6 hours</option>
            <option value="24h">Last 24 hours</option>
            <option value="7d">Last 7 days</option>
          </select>
        </div>
        <div class="history-chart-container">
          <canvas class="history-chart" id="temperature-history-chart" width="200" height="40"></canvas>
        </div>
        <div class="history-chart-container">
          <canvas class="history-chart" id="usage-history-chart" width="200" height="40"></canvas>
        </div>
        <div class="history-chart-container">
          <canvas class="history-chart" id="frequency-history-chart" width="200" height="40"></canvas>
        </div>
      </section>

      <section class="battery-power-strip" id="battery-power-strip">
        <div class="battery-info">
          <svg class="battery-icon" id="battery-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="7" width="16" height="10" rx="2" ry="2"></rect>
            <line x1="18" y1="11" x2="20" y2="11"></line>
          </svg>
          <span class="battery-level" id="battery-level">--</span>
          <span class="battery-status" id="battery-status">--</span>
        </div>
        <div class="power-info">
          <span class="power-label">Power:</span>
          <span class="power-value" id="power-value">-- W</span>
        </div>
        <div class="time-remaining" id="time-remaining">--</div>
      </section>

      <!-- Icon Line -->
      <div class="icon-line" id="icon-line">
        <!-- Icon 1: Monitors -->
        <button class="icon-line-item" id="icon-monitors" title="Monitors">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
            <line x1="8" y1="21" x2="16" y2="21"></line>
            <line x1="12" y1="17" x2="12" y2="21"></line>
            <circle cx="6" cy="6" r="1"></circle>
            <circle cx="12" cy="6" r="1"></circle>
            <circle cx="18" cy="6" r="1"></circle>
          </svg>
        </button>
        
        <!-- Icon 2: Ollama (Official Ollama icon) -->
        <button class="icon-line-item" id="icon-ollama" title="AI Chat (Ollama)">
          <img src="/assets/ollama.svg" alt="Ollama" />
        </button>
        
        <!-- Icons 3-15: Placeholders -->
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
        <div class="icon-line-item icon-placeholder" title="Coming soon"></div>
      </div>

      <div class="arch-rule" aria-hidden="true"></div>

      <!-- External Monitors Section (Collapsible) -->
      <section class="monitors-section">
        <div class="section-header-collapsible" id="monitors-header">
          <div class="section-title-with-status">
            <h2 class="section-title">External / Monitors</h2>
            <div class="monitors-status-dot-container">
              <span class="monitors-status-dot" id="monitors-status-dot"></span>
            </div>
          </div>
          <div class="monitors-header-actions">
            <button class="monitors-menu-btn" id="monitors-menu-btn" title="Settings">⋯</button>
          </div>
        </div>
        <div class="section-content-collapsible" id="monitors-content">
          <div class="monitors-summary" id="monitors-summary">
            <span id="monitors-summary-text">0 / 0 sites up · Avg -- ms</span>
          </div>
          <div class="monitors-list" id="monitors-list"></div>
        </div>
      </section>

      <!-- Monitors Settings Popover -->
      <div class="monitors-settings-popover" id="monitors-settings-popover" style="display: none;">
        <div class="popover-content">
          <div class="popover-header">
            <h3>Monitor Settings</h3>
            <button class="popover-close" id="monitors-settings-close">×</button>
          </div>
          <div class="popover-body">
            <div class="monitors-list-container">
              <div class="monitors-list-header">
                <h4>Active Monitors</h4>
                <button class="popover-btn-primary" id="monitors-add-btn">+ Add Monitor</button>
              </div>
              <div class="monitors-settings-list" id="monitors-settings-list">
                <!-- Monitors will be listed here -->
              </div>
            </div>
            <div class="add-monitor-form" id="add-monitor-form" style="display: none;">
              <h4>Add New Monitor</h4>
              <label for="monitor-url-input">Website URL:</label>
              <input type="text" id="monitor-url-input" placeholder="https://www.amvara.de/" value="https://www.amvara.de/" />
              <div class="popover-actions">
                <button class="popover-btn-secondary" id="monitors-add-cancel">Cancel</button>
                <button class="popover-btn-primary" id="monitors-add-save">Add Monitor</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="arch-rule" id="monitors-ollama-divider" aria-hidden="true"></div>

      <!-- Ollama Chat Section (Collapsible) -->
      <section class="ollama-section">
        <div class="section-header-collapsible" id="ollama-header">
          <div class="section-title-with-status">
            <h2 class="section-title">AI Chat (Ollama)</h2>
            <button class="ollama-menu-btn" id="ollama-menu-btn" title="Options">⋯</button>
            <div class="ollama-menu" id="ollama-menu" style="display: none;">
              <button class="ollama-menu-item" id="ollama-menu-collapse">Collapse</button>
              <button class="ollama-menu-item" id="ollama-menu-settings">Settings</button>
            </div>
            <div class="ollama-header-controls">
              <div class="connection-indicator" id="ollama-connection-indicator" title="Click to configure Ollama URL"></div>
              <span class="model-text" id="ollama-model-text" style="display: none;">—</span>
              <select id="ollama-model-select" class="model-select-dropdown" style="display: none;">
                <option value="">Loading models...</option>
              </select>
            </div>
          </div>
        </div>
        <div class="section-content-collapsible" id="ollama-content">
          <div class="ollama-chat" id="ollama-chat" style="display: none;">
            <div class="chat-messages" id="chat-messages"></div>
            <div class="chat-input-container">
              <input type="text" id="chat-input" placeholder="Ask about system metrics..." />
              <button id="chat-send-btn">Send</button>
            </div>
          </div>
        </div>
      </section>

      <!-- System Prompt Settings Popover -->
      <div class="ollama-settings-popover" id="ollama-settings-popover" style="display: none;">
        <div class="popover-content">
          <div class="popover-header">
            <h3>Ollama Settings</h3>
            <button class="popover-close" id="ollama-settings-close">×</button>
          </div>
          <div class="popover-body">
            <label for="ollama-system-prompt">System Prompt:</label>
            <textarea id="ollama-system-prompt" rows="6" placeholder="You are a helpful assistant that answers questions about system metrics and monitoring."></textarea>
            <div class="popover-actions">
              <button class="popover-btn-secondary" id="ollama-settings-reset">Reset to Default</button>
              <button class="popover-btn-primary" id="ollama-settings-save">Save</button>
            </div>
          </div>
        </div>
      </div>

      <div class="arch-rule" aria-hidden="true"></div>

      <section class="arch-details" id="details-section">
        <h2 class="section-title collapsible-header" id="details-header">Details</h2>
        <div class="details-grid">
          <div class="detail-label">Load 1m</div>
          <div class="detail-value" id="load-1">0.0</div>

          <div class="detail-label">Load 5m</div>
          <div class="detail-value" id="load-5">0.0</div>

          <div class="detail-label">Load 15m</div>
          <div class="detail-value" id="load-15">0.0</div>

          <div class="detail-label">CPU Power</div>
          <div class="detail-value" id="cpu-power">0.0 W</div>

          <div class="detail-label">GPU Power</div>
          <div class="detail-value" id="gpu-power">0.0 W</div>

          <div class="detail-label">Uptime</div>
          <div class="detail-value" id="uptime-value">0h</div>
        </div>
      </section>

      <div class="arch-rule" aria-hidden="true"></div>

      <section class="arch-processes" id="processes-section">
        <h2 class="section-title collapsible-header" id="processes-header">Top Processes</h2>
        <div class="process-table" id="process-list"></div>
      </section>

      <footer class="arch-footer">
        <span class="arch-version">Architect v0.0.3</span>
        <a href="https://github.com/raro42/mac-stats" target="_blank" rel="noopener noreferrer" class="arch-github-link" id="github-link">GitHub</a>
      </footer>
    </main>

    <div id="settings-modal" class="settings-modal" style="display: none;">
      <div class="settings-card">
        <div class="settings-header">
          <h2>Settings</h2>
          <button id="close-settings" class="icon-btn" aria-label="Close">×</button>
        </div>
        <div class="settings-body">
          <div class="setting-item">
            <div class="setting-label">Theme</div>
            <div id="theme-list" class="theme-list" role="list">
              <button type="button" class="theme-item" data-theme="apple">Apple</button>
              <button type="button" class="theme-item" data-theme="architect">Architect</button>
              <button type="button" class="theme-item" data-theme="data-poster">Data Poster</button>
              <button type="button" class="theme-item" data-theme="dark">Dark (TUI)</button>
              <button type="button" class="theme-item" data-theme="futuristic">Futuristic</button>
              <button type="button" class="theme-item" data-theme="light">Light</button>
              <button type="button" class="theme-item" data-theme="material">Material</button>
              <button type="button" class="theme-item" data-theme="neon">Neon</button>
              <button type="button" class="theme-item" data-theme="swiss-minimalistic">Swiss Minimalistic</button>
            </div>
          </div>
          <div class="setting-item">
            <div class="setting-label">Window Frame</div>
            <label class="setting-toggle">
              <input type="checkbox" id="window-decorations-toggle" />
              <span class="toggle-label">Show window frame</span>
            </label>
            <div class="setting-note" style="font-size: 11px; color: rgba(35, 45, 65, 0.70); margin-top: 4px; font-style: italic;">Not yet functional</div>
          </div>
        </div>
      </div>
    </div>

    <div id="process-details-modal" class="settings-modal" style="display: none;">
      <div class="settings-card">
        <div class="settings-header">
          <h2>Process Details</h2>
          <button id="close-process-details" class="icon-btn" aria-label="Close">×</button>
        </div>
        <div class="settings-body" id="process-details-body"></div>
      </div>
    </div>

    <div id="changelog-modal" class="settings-modal" style="display: none;">
      <div class="settings-card changelog-card">
        <div class="settings-header">
          <h2>Changelog</h2>
          <button id="close-changelog" class="icon-btn" aria-label="Close">×</button>
        </div>
        <div class="settings-body changelog-body" id="changelog-body">
          <div class="changelog-loading">Loading changelog...</div>
        </div>
      </div>
    </div>

    <script src="../../tauri-logger.js"></script>
    <script type="module" src="../../ollama.js"></script>
    <script src="../../cpu.js"></script>
    <script src="../../cpu-ui.js"></script>
    <script src="./chart.js"></script>
  </body>
</html>
